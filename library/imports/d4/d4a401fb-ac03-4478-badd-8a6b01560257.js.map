{"version":3,"sources":["assets/scripts/PlayerItem.js"],"names":["UtilsFB","require","UtilsCommon","game_scene","ScreenMgr","cc","Class","Component","properties","rank","type","Label","portrait","Sprite","playerName","score","btnPlay","Node","btnPlayLabel","onLoad","node","on","onBtnClick","defaultPortraitSprite","spriteFrame","imageBase64","getScreenshotBase64","getCameraMain","playerData","isSelf","chooseAsync","error","invitePlayerAsync","id","then","playGame","bind","instance","closeScreen","onGameStart","updatePlayerInfo","string","getPlayerPhotoAsync","photoTexture","SpriteFrame","setTexture"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,IAAIA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAArB;;AACA,IAAIC,WAAW,GAAGD,OAAO,CAAC,aAAD,CAAzB;;AACA,IAAIE,UAAU,GAAGF,OAAO,CAAC,YAAD,CAAxB;;AACA,IAAIG,SAAS,GAAGH,OAAO,CAAC,WAAD,CAAvB;;AACAI,EAAE,CAACC,KAAH,CAAS;EACL,WAASD,EAAE,CAACE,SADP;EAGLC,UAAU,EAAE;IACRC,IAAI,EAAE;MACF,WAAS,IADP;MAEFC,IAAI,EAAEL,EAAE,CAACM;IAFP,CADE;IAKRC,QAAQ,EAAE;MACN,WAAS,IADH;MAENF,IAAI,EAAEL,EAAE,CAACQ;IAFH,CALF;IASRC,UAAU,EAAE;MACR,WAAS,IADD;MAERJ,IAAI,EAAEL,EAAE,CAACM;IAFD,CATJ;IAaRI,KAAK,EAAE;MACH,WAAS,IADN;MAEHL,IAAI,EAAEL,EAAE,CAACM;IAFN,CAbC;IAkBRK,OAAO,EAAE;MACL,WAAS,IADJ;MAELN,IAAI,EAAEL,EAAE,CAACY;IAFJ,CAlBD;IAuBRC,YAAY,EAAE;MACV,WAAS,IADC;MAEVR,IAAI,EAAEL,EAAE,CAACM;IAFC;EAvBN,CAHP;EAgCLQ,MAAM,EAAE,kBAAW;IACf,KAAKC,IAAL,CAAUC,EAAV,CAAa,OAAb,EAAsB,KAAKC,UAA3B,EAAuC,IAAvC;IACA,KAAKC,qBAAL,GAA6B,KAAKX,QAAL,CAAcY,WAA3C;EACH,CAnCI;EAqCLF,UAAU,EAAE,sBAAW;IACnB,IAAIG,WAAW,GAAGvB,WAAW,CAACwB,mBAAZ,CAAgCxB,WAAW,CAACyB,aAAZ,EAAhC,CAAlB;;IACA,IAAI,KAAKC,UAAL,CAAgBC,MAApB,EAA4B;MACxB7B,OAAO,CAAC8B,WAAR,CAAoBL,WAApB,WAAuC,UAAAM,KAAK,EAAG,CAAE,CAAjD;IACH,CAFD,MAEO;MACH/B,OAAO,CAACgC,iBAAR,CAA0B,KAAKJ,UAAL,CAAgBK,EAA1C,EAA8CR,WAA9C,EACCS,IADD,CACM,YAAW;QACb,KAAKC,QAAL;MACH,CAFK,CAEJC,IAFI,CAEC,IAFD,CADN,WAIO,UAASL,KAAT,EAAgB;QACnB,KAAKI,QAAL;MACH,CAFM,CAELC,IAFK,CAEA,IAFA,CAJP;IAOH;EACJ,CAlDI;EAoDLD,QAAQ,EAAE,oBAAW;IACjB/B,SAAS,CAACiC,QAAV,CAAmBC,WAAnB,CAA+B,uBAA/B;IACAlC,SAAS,CAACiC,QAAV,CAAmBC,WAAnB,CAA+B,gBAA/B;IACAnC,UAAU,CAACkC,QAAX,CAAoBE,WAApB,CAAgC,IAAhC,EAAsC,KAAtC;EACH,CAxDI;EA0DLC,gBAAgB,EAAE,0BAASZ,UAAT,EAAqB;IACnC;IACA,KAAKA,UAAL,GAAkBA,UAAlB;IACA,KAAKnB,IAAL,CAAUgC,MAAV,GAAmBb,UAAU,CAACnB,IAA9B;IACA,KAAKK,UAAL,CAAgB2B,MAAhB,GAAyBb,UAAU,CAACd,UAApC;IACA,KAAKC,KAAL,CAAW0B,MAAX,GAAoBb,UAAU,CAACb,KAA/B,CALmC,CAOnC;;IACAf,OAAO,CAAC0C,mBAAR,CAA4Bd,UAA5B,EACCM,IADD,CACM,YAAW;MACb,IAAIN,UAAU,CAACe,YAAX,IAA2B,IAA/B,EAAqC;QACjC,KAAK/B,QAAL,CAAcY,WAAd,GAA4B,IAAInB,EAAE,CAACuC,WAAP,EAA5B;QACA,KAAKhC,QAAL,CAAcY,WAAd,CAA0BqB,UAA1B,CAAqCjB,UAAU,CAACe,YAAhD;MACH;IACJ,CALK,CAKJP,IALI,CAKC,IALD,CADN,WAOO,UAAAL,KAAK,EAAI,CAAE,CAPlB;IASA,KAAKb,YAAL,CAAkBuB,MAAlB,GAA2B,KAAKb,UAAL,CAAgBC,MAAhB,GAAyB,OAAzB,GAAmC,MAA9D;EACH;AA5EI,CAAT","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nvar UtilsFB = require(\"UtilsFB\");\nvar UtilsCommon = require(\"UtilsCommon\");\nvar game_scene = require('game_scene');\nvar ScreenMgr = require('ScreenMgr');\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        rank: {\n            default: null,\n            type: cc.Label,\n        },\n        portrait: {\n            default: null,\n            type: cc.Sprite,\n        },\n        playerName: {\n            default: null,\n            type: cc.Label,\n        },\n        score: {\n            default: null,\n            type: cc.Label,\n        },\n\n        btnPlay: {\n            default: null,\n            type: cc.Node,\n        },\n\n        btnPlayLabel: {\n            default: null,\n            type: cc.Label,\n        },\n    },\n\n    onLoad: function() {\n        this.node.on('click', this.onBtnClick, this);\n        this.defaultPortraitSprite = this.portrait.spriteFrame;\n    },\n\n    onBtnClick: function() {\n        var imageBase64 = UtilsCommon.getScreenshotBase64(UtilsCommon.getCameraMain());\n        if (this.playerData.isSelf) {\n            UtilsFB.chooseAsync(imageBase64).catch(error =>{});\n        } else {\n            UtilsFB.invitePlayerAsync(this.playerData.id, imageBase64)\n            .then(function() {\n                this.playGame();   \n            }.bind(this))\n            .catch(function(error) {\n                this.playGame();\n            }.bind(this));\n        }\n    },\n\n    playGame: function() {\n        ScreenMgr.instance.closeScreen('ScreenHomeLeaderboard');\n        ScreenMgr.instance.closeScreen('ScreenGameOver');\n        game_scene.instance.onGameStart(true, false);\n    },\n\n    updatePlayerInfo: function(playerData) {\n        // console.log(\"update player info: \" + JSON.stringify(playerData));\n        this.playerData = playerData;\n        this.rank.string = playerData.rank;\n        this.playerName.string = playerData.playerName;\n        this.score.string = playerData.score;\n\n        // this.portrait.spriteFrame = this.defaultPortraitSprite;\n        UtilsFB.getPlayerPhotoAsync(playerData)\n        .then(function() {\n            if (playerData.photoTexture != null) {\n                this.portrait.spriteFrame = new cc.SpriteFrame();\n                this.portrait.spriteFrame.setTexture(playerData.photoTexture);\n            }\n        }.bind(this))\n        .catch(error => {});\n\n        this.btnPlayLabel.string = this.playerData.isSelf ? 'Share' : 'Play';\n    },\n});\n"]}