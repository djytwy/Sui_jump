{"version":3,"sources":["assets/scripts/ScreenGameOver.js"],"names":["ScreenMgr","require","UtilsCommon","UtilsFB","game_scene","base64ToBinary","base64String","base64Cleaned","split","binaryString","atob","len","length","bytes","Uint8Array","i","charCodeAt","buffer","cc","Class","Component","properties","titleNewScore","type","Node","labelScore","Label","labelScoreMax","screenLeaderboard","btnHome","Button","btnUpload","btnPlayAgain","loading","blobId","SuiId","RichText","successTips","errorTips","start","onEnable","node","active","score","instance","scoreMAx","window","localStorage","getItem","parseInt","Math","max","setItem","string","clearLeaderboard","setLeaderboardAsync","ConstValue","LEADERBOARD_SOCRE_WORLD","then","showLeaderboard","bind","error","console","log","JSON","stringify","onBtnClickHome","showScreen","onBtnClickShare","imageBase64","getScreenshotBase64","getCameraMain","chooseAsync","onBtnClickPlayAgain","onGameStart","onBtnClickContinue","onBtnClickUpload","fetch","method","body","res","status","json","data","newlyCreated","blobObject","id","text","errorData"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\nimport * as ConstValue from './ConstValue';\n\nvar ScreenMgr = require('ScreenMgr');\nvar UtilsCommon = require('UtilsCommon');\nvar UtilsFB = require('UtilsFB');\nvar game_scene = require('game_scene');\n\nfunction base64ToBinary(base64String) {\n    const base64Cleaned = base64String.split(',')[1];\n\n    const binaryString = atob(base64Cleaned);\n    const len = binaryString.length;\n    const bytes = new Uint8Array(len);\n\n    for (let i = 0; i < len; i++) {\n        bytes[i] = binaryString.charCodeAt(i);\n    }\n\n    return bytes.buffer;\n}\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        titleNewScore: {\n            default: null,\n            type: cc.Node,\n        },\n\n        labelScore: {\n            default: null,\n            type: cc.Label,\n        },\n\n        labelScoreMax: {\n            default: null,\n            type: cc.Label,\n        },\n\n        screenLeaderboard: {\n            default: null,\n            type: require('ScreenLeaderboard'),\n        },\n\n        btnHome: {\n            default: null,\n            type: cc.Button\n        },\n        btnUpload: {\n            default: null,\n            type: cc.Button\n        },\n        btnPlayAgain: {\n            default: null,\n            type: cc.Button\n        },\n        loading: {\n            default: null,\n            type: cc.Label,\n        },\n        blobId: {\n            default: null,\n            type: cc.Label,\n        },\n        SuiId: {\n            default: null,\n            type: cc.RichText,\n        },\n        successTips: {\n            default: null,\n            type: cc.Label,\n        },\n        errorTips: {\n            default: null,\n            type: cc.Label,\n        }\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start() {\n\n    },\n\n    // update (dt) {},\n\n    onEnable() {\n        this.btnHome.node.active = true;\n        this.btnUpload.node.active = true;\n        this.btnPlayAgain.node.active = true;\n        this.labelScore.node.active = true;\n        this.loading.node.active = false;\n        // upload status:\n        this.blobId.node.active = false;\n        this.SuiId.node.active = false;\n        this.successTips.node.active = false;\n        this.errorTips.node.active = false;\n\n        let score = game_scene.instance.score;\n        // let scoreMAx = UtilsFB.getSelfLeaderboardScore(ConstValue.LEADERBOARD_SOCRE_WORLD);\n        let scoreMAx = window.localStorage.getItem(\"maxScore\") ? parseInt(window.localStorage.getItem(\"maxScore\")) : 0\n\n        this.titleNewScore.active = score > 0 && score > scoreMAx;\n        scoreMAx = Math.max(scoreMAx, score);\n        window.localStorage.setItem(\"maxScore\", scoreMAx)\n\n        this.labelScore.string = \"\" + score;\n        this.labelScoreMax.string = \"Max Score: \" + scoreMAx;\n\n        this.screenLeaderboard.clearLeaderboard();\n        UtilsFB.setLeaderboardAsync(ConstValue.LEADERBOARD_SOCRE_WORLD, this.score)\n            .then(function () {\n                this.screenLeaderboard.showLeaderboard(ConstValue.LEADERBOARD_SOCRE_WORLD);\n            }.bind(this))\n            .catch(error => {\n                console.log(\"setleaderboardasync error: \" + JSON.stringify(error));\n            });\n    },\n\n    onBtnClickHome() {\n        console.log('home.......');\n\n        ScreenMgr.instance.showScreen('ScreenHome');\n        this.node.active = false;\n    },\n\n    onBtnClickShare() {\n        var imageBase64 = UtilsCommon.getScreenshotBase64(UtilsCommon.getCameraMain());\n        UtilsFB.chooseAsync(imageBase64).catch(error => { });\n    },\n\n    onBtnClickPlayAgain() {\n        game_scene.instance.onGameStart(true, false);\n    },\n\n    onBtnClickContinue() {\n        var imageBase64 = UtilsCommon.getScreenshotBase64(UtilsCommon.getCameraMain());\n        UtilsFB.chooseAsync(imageBase64)\n            .then(function () {\n                game_scene.instance.onGameStart(true, true);\n            })\n            .catch(error => { });\n    },\n\n    async onBtnClickUpload() {\n        this.errorTips.node.active = false;\n        var imageBase64 = UtilsCommon.getScreenshotBase64(UtilsCommon.getCameraMain());\n        console.log(imageBase64);\n\n        this.btnHome.node.active = false;\n        this.btnUpload.node.active = false;\n        this.btnPlayAgain.node.active = false;\n        this.loading.node.active = true;\n\n\n        const res = await fetch('https://publisher-devnet.walrus.space/v1/store?epochs=1', {\n            method: 'PUT',\n            body: base64ToBinary(imageBase64)\n        });\n        if (res.status === 200) {\n            const data = await res.json();\n            console.log(data);\n            this.blobId.string = 'Blodid: ' + data.newlyCreated.blobObject.blobId;\n            this.SuiId.string = 'Id: ' + data.newlyCreated.blobObject.id;\n            this.blobId.node.active = true;\n            this.SuiId.node.active = true;\n            this.successTips.node.active = true;\n            this.loading.node.active = false;\n            this.btnHome.node.active = true;\n            this.btnUpload.node.active = true;\n            this.btnPlayAgain.node.active = true;\n            /**\n             * {\n                    newlyCreated: {\n                        blobObject: {\n                        id: '0x20c6a2915047479f7920f183cbc5953b708cfcc4118d57cd33e2344a93d6d02c',\n                        storedEpoch: 0,\n                        blobId: 'HPTDv1DG7z-ikDUJA0utYfLO00oMuDH3xz8Fok2a1PI',\n                        size: 39635,\n                        erasureCodeType: 'RedStuff',\n                        certifiedEpoch: 0,\n                        storage: [Object]\n                        },\n                        encodedSize: 65023000,\n                        cost: 3175000\n                    }\n                }\n             */\n        } else {\n            this.errorTips.node.active = true;\n\n            this.btnHome.node.active = true;\n            this.btnUpload.node.active = true;\n            this.btnPlayAgain.node.active = true;\n            this.loading.node.active = false;\n\n            console.error('Error:', res.status);\n            const errorData = await res.text();\n            console.error('Error details:', errorData);\n        }\n    }\n});\n"]}