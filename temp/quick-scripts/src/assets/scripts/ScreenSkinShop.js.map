{"version":3,"sources":["assets/scripts/ScreenSkinShop.js"],"names":["SkinMgr","require","game_scene","ScreenMgr","UtilsFB","UtilsCommon","ScreenSkinShop","cc","Class","Component","properties","skinItemPrefab","type","Prefab","content","Node","processBar","processTitle","Label","statics","instance","onLoad","skinItemPool","NodePool","start","unlockCountArray","i","getSkinSpriteFrameCount","skinSpriteFrame","getSkinSpriteFrame","skinItem","spawnSkinItem","node","setParent","choosed","currentSkinIndex","unlockCount","length","init","updateLockState","onEnable","onChoose","index","onSkinChange","childrenCount","children","getComponent","onUnchoose","skinItemNode","size","get","instantiate","despawnSkinItem","item","put","onBtnClickHome","showScreen","closeScreen","onBtnClickInvite","imageBase64","getScreenshotBase64","getCameraMain","chooseAsync","then","incrementInvitedCount","bind","error","totalCount","processBarWidth","width","position","v2","string"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\nvar SkinMgr = require('SkinMgr');\nvar game_scene = require('game_scene');\nvar ScreenMgr = require('ScreenMgr');\nvar UtilsFB = require('UtilsFB');\nvar UtilsCommon = require('UtilsCommon');\nvar ScreenSkinShop = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        skinItemPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n\n        content: {\n            default: null,\n            type: cc.Node,\n        },\n\n        processBar: {\n            default: null,\n            type: cc.Node,\n        },\n\n        processTitle: {\n            default: null,\n            type: cc.Label,\n        },\n    },\n\n    statics: {\n        instance: null,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        ScreenSkinShop.instance = this;\n        this.skinItemPool = new cc.NodePool('SkinItem');\n    },\n\n    start() {\n        let unlockCountArray = [0, 1, 2, 5];\n        for (let i = 0; i < SkinMgr.instance.getSkinSpriteFrameCount(); i++) {\n            let skinSpriteFrame = SkinMgr.instance.getSkinSpriteFrame(i);\n            let skinItem = this.spawnSkinItem();\n            skinItem.node.setParent(this.content);\n            let choosed = i == game_scene.instance.currentSkinIndex;\n\n            let unlockCount = 0;\n            if (i < unlockCountArray.length) {\n                unlockCount = unlockCountArray[i];\n            } else {\n                unlockCount = unlockCountArray[unlockCountArray.length - 1] + (i - unlockCountArray.length + 1) * 5;\n            }\n            // skinItem.init(skinSpriteFrame, choosed, unlockCount);\n            skinItem.init(skinSpriteFrame, choosed, 0);\n        }\n\n        this.updateLockState();\n    },\n\n    onEnable() {\n        this.updateLockState();\n    },\n\n    onChoose: function (index) {\n        game_scene.instance.onSkinChange(index);\n\n        for (let i = 0; i < this.content.childrenCount; i++) {\n            let skinItem = this.content.children[i].getComponent('SkinItem');\n            if (i != index) {\n                skinItem.onUnchoose();\n            }\n        }\n    },\n\n    spawnSkinItem: function () {\n        let skinItemNode = null;\n        if (this.skinItemPool.size() > 0) {\n            skinItemNode = this.skinItemPool.get();\n        } else {\n            skinItemNode = cc.instantiate(this.skinItemPrefab);\n        }\n\n        return skinItemNode.getComponent('SkinItem');\n    },\n\n    despawnSkinItem: function (item) {\n        this.skinItemPool.put(item.node);\n    },\n\n    onBtnClickHome: function () {\n        ScreenMgr.instance.showScreen('ScreenHome');\n        ScreenMgr.instance.closeScreen('ScreenSkinShop');\n    },\n\n    onBtnClickInvite() {\n        var imageBase64 = UtilsCommon.getScreenshotBase64(UtilsCommon.getCameraMain());\n        UtilsFB.chooseAsync(imageBase64, ['NEW_CONTEXT_ONLY'])\n            .then(function () {\n                SkinMgr.instance.incrementInvitedCount();\n                this.updateLockState();\n            }.bind(this))\n            .catch(error => { });\n    },\n\n    updateLockState() {\n        let unlockCount = 0;\n        let totalCount = this.content.childrenCount;\n        for (let i = 0; i < this.content.childrenCount; i++) {\n            let skinItem = this.content.children[i].getComponent('SkinItem');\n            if (skinItem.updateLockState()) {\n                unlockCount += 1;\n            }\n        }\n\n        let processBarWidth = this.processBar.width;\n        this.processBar.position = cc.v2(-processBarWidth + processBarWidth * unlockCount / totalCount, 0);\n        this.processTitle.string = unlockCount + \"/\" + totalCount;\n    },\n});\n"]}