{"version":3,"sources":["assets/scripts/UtilsFB.js"],"names":["UtilsFB","cc","Class","Component","statics","leaderboardMapLocal","init","leaderboardName","getLeaderboardAsync","error","invitePlayerRandomAsync","imageBase64","Promise","resolve","reject","FBInstant","player","getConnectedPlayersAsync","then","players","length","randomIndex","Math","floor","random","playerID","getID","invitePlayerAsync","debugLog","JSON","stringify","context","createAsync","updateAsync","action","cta","image","text","localizations","template","strategy","notification","data","createId","playerArray","getLeaderboardLocal","leaderboard","getConnectedPlayerEntriesAsync","entries","Array","leaderboardScoreSelf","getSelfLeaderboardScore","i","playerInfo","getPlayer","isSelf","id","playerName","getName","photoUrl","getPhoto","score","max","getScore","rank","getRank","photoTexture","push","updateLeaderboardLocal","loadPlayerArrayPhoto","loadPlayerPhotoAsync","loader","load","url","type","err","texture","setLeaderboardAsync","setLeaderboardLocal","setScoreAsync","getPlayerPhotoAsync","ret","playerArrayLocal","scoreUpdated","compare","play1","play2","score1","score2","sort","getPlayerInfoScoreOvertake","scoreBefore","scoreCurrent","playerOvertaken","shareAsync","message","intent","myReplayData","chooseAsync","filters"],"mappings":"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","sourceRoot":"/","sourcesContent":["var UtilsFB = cc.Class({\n    extends: cc.Component,\n\n    statics: {\n        leaderboardMapLocal: {},\n\n        init: function(leaderboardName) {\n            UtilsFB.getLeaderboardAsync(leaderboardName).catch(error => {});\n        },\n\n        invitePlayerRandomAsync: function(imageBase64) {\n            return new Promise(function(resolve, reject) {\n                if (typeof FBInstant === 'undefined') {\n                    reject(\"FBInstant undefined\");\n                    return;\n                }\n\n                FBInstant.player.getConnectedPlayersAsync()\n                .then(function(players) {\n                    if (players.length) {\n                        let randomIndex = Math.floor((Math.random() * players.length));\n                        let playerID = players[randomIndex].getID();\n                        UtilsFB.invitePlayerAsync(playerID, imageBase64)\n                        .then(function() {\n                            resolve();\n                        })\n                        .catch(function(error) {\n                            reject(error);\n                        });\n                    } else {\n                        UtilsFB.debugLog(\"getConnectedPlayersAsync error: player count 0.\")\n                        reject(\"Player count is 0.\");\n                    }\n                })\n                .catch(function(error) {\n                    UtilsFB.debugLog(\"getConnectedPlayersAsync error: \" + JSON.stringify(error));\n                    reject(error);\n                });\n            });\n        },\n\n        invitePlayerAsync: function(playerID, imageBase64) {\n            return new Promise(function(resolve, reject) {\n                if (typeof FBInstant === 'undefined') {\n                    reject(\"FBInstant undefined\");\n                    return;\n                }\n\n                FBInstant.context.createAsync(playerID)\n                .then(function() {\n                    FBInstant.updateAsync({\n                        action: 'CUSTOM',\n                        cta: 'Join the Game',\n                        image: imageBase64,\n                        text: {\n                            default: 'Play with me',\n                            localizations: {\n\n                            }\n                        },\n                        template: 'VILLAGE_INVASION',\n                        strategy: 'IMMEDIATE',\n                        notification: 'NO_PUSH',\n                        data: {\n                            createId:playerID\n                        }\n                    })\n                    .then(function() {\n                        // UtilsFB.debugLog(\"updateAsync success.\");\n                        resolve();\n                    })\n                    .catch(function(error) {\n                        UtilsFB.debugLog(\"updateAsync error: \" + JSON.stringify(error));\n                        reject(error);\n                    });\n                })\n                .catch(function(error) {\n                    UtilsFB.debugLog(\"createAsync error: \" + JSON.stringify(error));\n                    reject(error);\n                });\n            });\n        },\n\n        getLeaderboardAsync: function(leaderboardName) {\n            UtilsFB.debugLog(\"getLeaderboardAsync\");\n            return new Promise(function(resolve, reject) {\n                if (typeof FBInstant === 'undefined') {\n                    reject(\"FBInstant undefined\");\n                    return;\n                }\n\n                let playerArray = UtilsFB.getLeaderboardLocal(leaderboardName);\n                if (playerArray != null) {\n                    UtilsFB.debugLog(\"getLeaderboardAsync local\");\n                    resolve(playerArray);\n                }\n\n                FBInstant\n                .getLeaderboardAsync(leaderboardName)\n                .then(function(leaderboard) {\n                    UtilsFB.debugLog(\"getLeaderboardAsync leaderboard: \" + JSON.stringify(leaderboard));\n                    return leaderboard.getConnectedPlayerEntriesAsync(10, 0)\n                })\n                .then(function(entries) {\n                    UtilsFB.debugLog(\"getConnectedPlayerEntriesAsync entries: \" + JSON.stringify(entries));\n                    let playerArray = new Array();\n                    let leaderboardScoreSelf = UtilsFB.getSelfLeaderboardScore();\n                    for (let i = 0; i < entries.length; i++) {\n                        let playerInfo = {};\n                        let player = entries[i].getPlayer();\n                        playerInfo.isSelf = player.getID() == FBInstant.player.getID();\n                        playerInfo.id = player.getID();\n                        playerInfo.playerName = player.getName();\n                        playerInfo.photoUrl = player.getPhoto();\n                        // 如果是自己，设置大的分数，防止分数还没保存上时，获取到的分数是旧的\n                        if (playerInfo.isSelf) {\n                            playerInfo.score = Math.max(leaderboardScoreSelf, entries[i].getScore());\n                        } else {\n                            playerInfo.score = entries[i].getScore();\n                        }\n                        playerInfo.rank = entries[i].getRank();\n                        playerInfo.photoTexture = null;\n                        playerArray.push(playerInfo);\n                    }\n\n                    UtilsFB.updateLeaderboardLocal(leaderboardName, playerArray);\n                    resolve(playerArray);\n                })\n                .catch(function(error) {\n                    UtilsFB.debugLog(\"getLeaderboardAsync error: \" + JSON.stringify(error));\n                    reject(error);\n                });\n            });\n        },\n\n        loadPlayerArrayPhoto: function(playerArray) {\n            UtilsFB.debugLog(\"loadPlayerArrayPhoto\");\n            if (playerArray != null) {\n                for (let i = 0; i < playerArray.length; i++) {\n                    UtilsFB.loadPlayerPhotoAsync(playerArray[i]).catch(error => {});\n                }\n            }\n        },\n\n        loadPlayerPhotoAsync: function(playerInfo) {\n            return new Promise(function(resolve, reject) {\n                cc.loader.load({url: playerInfo.photoUrl, type: 'jpg'}, function (err, texture) {\n                    if (texture != null) {\n                        playerInfo.photoTexture = texture;\n                        resolve();\n                    } else {\n                        UtilsFB.debugLog(\"loadPlayerPhotoAsync error: \" + JSON.stringify(err));\n                        reject(err);\n                    }\n                });\n            });\n       },\n\n        setLeaderboardAsync(leaderboardName, score) {\n            UtilsFB.debugLog(\"setLeaderboardAsync\");\n            return new Promise(function(resolve, reject) {\n                if (typeof FBInstant == 'undefined') {\n                    reject(\"FBInstant undefined\");\n                    return;\n                }\n\n                if (UtilsFB.setLeaderboardLocal(leaderboardName, score)) {\n                    resolve();\n                }\n\n                FBInstant\n                .getLeaderboardAsync(leaderboardName)\n                .then(leaderboard => {\n                    return leaderboard.setScoreAsync(score);\n                })\n                .then(function() {\n                    resolve();\n                })\n                .catch(function(error) {\n                    UtilsFB.debugLog(\"setLeaderboardAsync error: \" + JSON.stringify(error));\n                    reject(error);\n                });\n            });\n        },\n\n        getPlayerPhotoAsync(playerInfo) {\n            return new Promise(function(resolve, reject) {\n                if (playerInfo.photoTexture != null) {\n                    resolve();\n                } else {\n                    UtilsFB.loadPlayerPhotoAsync(playerInfo)\n                    .then(function() {\n                        resolve();\n                    })\n                    .catch(function(error) {\n                        UtilsFB.debugLog(\"getPlayerPhotoAsync error: \" + JSON.stringify(error));\n                        reject(error);\n                    });\n                }\n            });\n        },\n\n        getLeaderboardLocal(leaderboardName) {\n            if (leaderboardName in UtilsFB.leaderboardMapLocal) {\n                return UtilsFB.leaderboardMapLocal[leaderboardName].playerArray;\n            }\n            return null;\n        },\n\n        updateLeaderboardLocal(leaderboardName, playerArray) {\n            UtilsFB.debugLog(\"updateLeaderboardLocal: \" + leaderboardName);\n            if (!(leaderboardName in UtilsFB.leaderboardMapLocal)) {\n                UtilsFB.leaderboardMapLocal[leaderboardName] = {};\n\n            }\n            UtilsFB.leaderboardMapLocal[leaderboardName].playerArray = playerArray;\n            UtilsFB.loadPlayerArrayPhoto(UtilsFB.leaderboardMapLocal[leaderboardName].playerArray);\n        },\n\n        setLeaderboardLocal(leaderboardName, score) {\n            let ret = false;\n            if (leaderboardName in UtilsFB.leaderboardMapLocal) {\n                let playerArrayLocal = UtilsFB.leaderboardMapLocal[leaderboardName].playerArray;\n                let scoreUpdated = false;\n                if (playerArrayLocal != null) {\n                    for (let i = 0; i < playerArrayLocal.length; i++) {\n                        let playerInfo = playerArrayLocal[i];\n                        if (playerInfo.isSelf) {\n                            if (score > playerInfo.score) {\n                                playerInfo.score = score;\n                                scoreUpdated = true;\n                            }\n                            ret = true;\n                        }\n                    }\n                }\n\n                if (scoreUpdated) {\n                    let compare = function(play1, play2) {\n                        let score1 = play1.score;\n                        let score2 = play2.score;\n                        if (score1 < score2) {\n                            return 1;\n                        } else if (score1 > score2) {\n                            return -1;\n                        } else {\n                            return 0;\n                        }\n                    };\n\n                    playerArrayLocal.sort(compare);\n\n                    for (let i = 0; i < playerArrayLocal.length; i++) {\n                        playerArrayLocal[i].rank = i + 1;\n                    }\n                }\n            }\n\n            return ret;\n        },\n\n        getPlayerInfoScoreOvertake(leaderboardName, scoreBefore, scoreCurrent) {\n            let playerOvertaken = [];\n            let playerArray = UtilsFB.getLeaderboardLocal(leaderboardName);\n            if (playerArray != null) {\n                for (let i = 0; i < playerArray.length; i++) {\n                    let playerInfo = playerArray[i];\n                    let score = playerInfo.score;\n                    if (scoreBefore <= score && score < scoreCurrent) {\n                        playerOvertaken.push(playerInfo);\n                    }\n                }\n            }\n\n            return playerOvertaken;\n        },\n\n        getSelfLeaderboardScore(leaderboardName) {\n            let playerArray = UtilsFB.getLeaderboardLocal(leaderboardName);\n            if (playerArray != null) {\n                for (let i = 0; i < playerArray.length; i++) {\n                    let playerInfo = playerArray[i];\n                    if (playerInfo.isSelf) {\n                        return playerInfo.score;\n                    }\n                }\n            }\n\n            return -1;\n        },\n\n        shareAsync: function(message, imageBase64) {\n            return new Promise(function(resolve, reject) {\n                if (typeof FBInstant == 'undefined') {\n                    reject(\"FBInstant undefined\");\n                    return;\n                }\n\n                FBInstant.shareAsync({\n                    intent: 'SHARE',\n                    image: imageBase64,\n                    text: message,\n                    data: {myReplayData: '...' },\n                }).then(function() {\n                    resolve();\n                })\n                .catch(function(error) {\n                    UtilsFB.debugLog(\"shareAsync error: \" + JSON.stringify(error));\n                    reject(error);\n                });\n            });\n        },\n\n        chooseAsync: function(imageBase64, filters) {\n            return new Promise(function(resolve, reject) {\n                if (typeof FBInstant == 'undefined') {\n                    reject(\"FBInstant undefined\");\n                    return;\n                }\n\n                filters = filters || [];\n\n                FBInstant.context.chooseAsync({\n                    filters: filters,\n                }).then(function() {\n                    FBInstant.updateAsync({\n                        action: 'CUSTOM',\n                        cta: 'Join the Game',\n                        image: imageBase64,\n                        text: {\n                            default: 'Play with me',\n                            localizations: {\n\n                            }\n                        },\n                        template: 'VILLAGE_INVASION',\n                        strategy: 'IMMEDIATE',\n                        notification: 'NO_PUSH',\n                        data: {\n                        }\n                    })\n                    .then(function() {\n                        UtilsFB.debugLog(\"chooseAsync success.\");\n                        resolve();\n                    })\n                    .catch(function(error) {\n                        UtilsFB.debugLog(\"chooseAsync updateAsync error: \" + JSON.stringify(error));\n                        reject(error);\n                    });\n                })\n                .catch(function(error) {\n                    UtilsFB.debugLog(\"chooseAsync error: \" + JSON.stringify(error));\n                    reject(error);\n                });\n            });\n        },\n\n        debugLog: function(message) {\n            // console.log(\"[fb]\" + message);\n        },\n    },\n});\n"]}