{"version":3,"sources":["assets/scripts/player.js"],"names":["game_scene","require","cc","Class","Component","properties","init_speed","a_power","y_radio","game_manager","type","audioJumpPressOnce","AudioClip","audioJumpPressRepeat","audioJumpSuccess","audioJumpFail","pressParticle","ParticleSystem","onLoad","next_block","direction","jumping","motionStreak","getComponent","MotionStreak","player_jump","enabled","x_distance","y_distance","target_pos","node","getPosition","x","y","rot_node","runAction","rotateBy","w_pos","parent","convertToWorldSpaceAR","is_game_over","jumpScore","is_jump_on_block","convertToNodeSpaceAR","sub","j","jumpTo","Math","random","end_func","callFunc","on_checkout_game","audioEngine","playEffect","move_map","playerPosWorld","gainScore","bind","seq","sequence","set_next_block","block","start","getChildByName","anim_node","is_power_mode","speed","on","Node","EventType","TOUCH_START","e","onTouchStart","TOUCH_END","onTouchEnd","TOUCH_CANCEL","mapMoving","stopAllActions","scaleTo","resetSystem","playTouchSound","stopTouchSound","audioIDPressOnce","audioTimePressOnce","getDuration","audioPressRepeatAlreadyPlay","audioPressRepeatCallback","audioIDPressRepeat","scheduleOnce","stopEffect","unschedule","update","dt"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\r\nvar game_scene = require(\"game_scene\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        init_speed: 150,\r\n        a_power: 600,\r\n        y_radio: 0.5560472,\r\n\r\n        game_manager: {\r\n            type: game_scene,\r\n            default: null,\r\n        },\r\n\r\n        audioJumpPressOnce: {\r\n            default: null,\r\n            type: cc.AudioClip,\r\n        },\r\n\r\n        audioJumpPressRepeat: {\r\n            default: null,\r\n            type: cc.AudioClip,\r\n        },\r\n\r\n        audioJumpSuccess: {\r\n            default: null,\r\n            type: cc.AudioClip,\r\n        },\r\n\r\n        audioJumpFail: {\r\n            default: null,\r\n            type: cc.AudioClip,\r\n        },\r\n\r\n        pressParticle: {\r\n            default: null,\r\n            type: cc.ParticleSystem,\r\n        },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        this.next_block = null;\r\n        this.direction = 1; // 1，-1\r\n        this.jumping = false;\r\n\r\n        this.motionStreak = this.getComponent(cc.MotionStreak);\r\n    },\r\n\r\n    player_jump() {\r\n        this.motionStreak.enabled = true;\r\n        this.jumping = true;\r\n\r\n        var x_distance = this.x_distance * this.direction;\r\n        var y_distance = this.x_distance * this.y_radio;\r\n\r\n        var target_pos = this.node.getPosition();\r\n        target_pos.x += x_distance;\r\n        target_pos.y += y_distance;\r\n\r\n        this.rot_node.runAction(cc.rotateBy(0.5, 360 * this.direction));\r\n\r\n        \r\n        var w_pos = this.node.parent.convertToWorldSpaceAR(target_pos);\r\n        var is_game_over = false;\r\n\r\n        var jumpScore = this.next_block.is_jump_on_block(w_pos, this.direction);\r\n\r\n        if (jumpScore > 0) {\r\n            target_pos = this.node.parent.convertToNodeSpaceAR(w_pos); // target_pos就变成了参考点的位置;\r\n            y_distance = target_pos.sub(this.node.getPosition()).y;\r\n        } else {\r\n            is_game_over = true;\r\n        }\r\n\r\n        var j = cc.jumpTo(0.5, target_pos, 200, 1);\r\n        this.direction = (Math.random() < 0.5) ? -1 : 1;\r\n\r\n        var end_func = cc.callFunc(function() {\r\n            this.motionStreak.enabled = false;\r\n            this.jumping = false;\r\n\r\n            if (is_game_over) {\r\n                this.game_manager.on_checkout_game();\r\n                cc.audioEngine.playEffect(this.audioJumpFail);\r\n            } else {\r\n                if (this.direction === -1) {\r\n                    this.game_manager.move_map(580 - w_pos.x, -y_distance);    \r\n                } else {\r\n                    this.game_manager.move_map(180 - w_pos.x, -y_distance);\r\n                }\r\n\r\n                let playerPosWorld = this.node.parent.convertToWorldSpaceAR(this.node.getPosition());\r\n                this.game_manager.gainScore(playerPosWorld, jumpScore);\r\n\r\n                cc.audioEngine.playEffect(this.audioJumpSuccess);\r\n            }\r\n        }.bind(this));\r\n\r\n        \r\n        var seq = cc.sequence(j, end_func);\r\n\r\n        this.node.runAction(seq);\r\n    },\r\n\r\n    set_next_block(block) {\r\n        this.next_block = block;\r\n    },\r\n\r\n    start () {\r\n        \r\n\r\n        this.rot_node = this.node.getChildByName(\"rotate\");\r\n        this.anim_node = this.rot_node.getChildByName(\"anim\");\r\n\r\n        this.is_power_mode = false;\r\n        this.speed = 0;\r\n        this.x_distance = 0;\r\n\r\n        this.game_manager.node.on(cc.Node.EventType.TOUCH_START, function(e) {\r\n            this.onTouchStart();\r\n        }.bind(this), this);\r\n\r\n        this.game_manager.node.on(cc.Node.EventType.TOUCH_END, function(e) {\r\n            this.onTouchEnd();\r\n        }.bind(this), this);\r\n\r\n        this.game_manager.node.on(cc.Node.EventType.TOUCH_CANCEL, function(e) {\r\n            this.onTouchEnd();\r\n        }.bind(this), this);\r\n    },\r\n\r\n    onTouchStart: function() {\r\n        if (this.game_manager.mapMoving || this.jumping) {\r\n            return;\r\n        }\r\n\r\n        this.is_power_mode = true;\r\n        this.x_distance = 0;\r\n        this.speed = this.init_speed;\r\n\r\n        this.anim_node.stopAllActions();\r\n        this.anim_node.runAction(cc.scaleTo(2, 1, 0.5));\r\n\r\n        this.pressParticle.enabled = true;\r\n        this.pressParticle.resetSystem();\r\n        this.playTouchSound();\r\n    },\r\n\r\n    onTouchEnd: function() {\r\n        if (this.is_power_mode) {\r\n            this.is_power_mode = false;\r\n            this.anim_node.stopAllActions();\r\n            this.anim_node.runAction(cc.scaleTo(0.5, 1, 1));\r\n\r\n            this.player_jump();\r\n\r\n            this.pressParticle.enabled = false;\r\n            this.stopTouchSound();\r\n        }\r\n    },\r\n\r\n    playTouchSound: function() {\r\n        this.audioIDPressOnce = cc.audioEngine.playEffect(this.audioJumpPressOnce, false);\r\n        var audioTimePressOnce = cc.audioEngine.getDuration(this.audioIDPressOnce);\r\n\r\n        this.audioPressRepeatAlreadyPlay = false;\r\n        this.audioPressRepeatCallback = function() {\r\n            this.audioPressRepeatAlreadyPlay = true;\r\n            this.audioIDPressRepeat = cc.audioEngine.playEffect(this.audioJumpPressRepeat, true)\r\n        };\r\n\r\n        //大音效播放完之后，开始重复播放小音效\r\n        this.scheduleOnce(this.audioPressRepeatCallback, audioTimePressOnce);\r\n    },\r\n\r\n    stopTouchSound: function() {\r\n        if (this.audioPressRepeatAlreadyPlay) {\r\n            cc.audioEngine.stopEffect(this.audioIDPressRepeat);\r\n        } else {\r\n            cc.audioEngine.stopEffect(this.audioIDPressOnce);\r\n            this.unschedule(this.audioPressRepeatCallback);\r\n        }\r\n    },\r\n\r\n    update (dt) {\r\n        if (this.is_power_mode) {\r\n            this.speed += (this.a_power * dt);\r\n            this.x_distance += this.speed * dt;\r\n        }\r\n    },\r\n});\r\n"]}