{"version":3,"sources":["assets/scripts/ScreenLeaderboard.js"],"names":["UtilsFB","require","UtilsCommon","cc","Class","Component","properties","playerItemPrefab","type","Prefab","content","Node","onLoad","playerItemPool","NodePool","canvasNode","find","showLeaderboard","leaderboardName","FBInstant","showLeaderboardDebug","getLeaderboardAsync","then","playerArray","showLeaderboardInternal","bind","error","node","active","updateLeaderboard","Array","i","playerInfo","id","playerName","score","rank","portraitUrl","push","show","beginPos","v2","height","endPos","showAction","moveTo","easing","easeCubicActionOut","position","runAction","hide","hideAction","easeCubicActionIn","clearLeaderboard","length","playerItemNode","spawnPlayerItem","getComponent","updatePlayerInfo","setParent","childrenCount","despawnPlayerItem","children","size","get","instantiate","put"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\nvar UtilsFB = require(\"UtilsFB\");\nvar UtilsCommon = require(\"UtilsCommon\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        playerItemPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n\n        content: {\n            default: null,\n            type: cc.Node,\n        },\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.playerItemPool = new cc.NodePool(\"playerItem\");\n        this.canvasNode = cc.find('Canvas');\n    },\n\n    showLeaderboard: function(leaderboardName) {\n        if (typeof FBInstant === 'undefined') {\n            this.showLeaderboardDebug();\n        }\n\n        UtilsFB.getLeaderboardAsync(leaderboardName)\n        .then(function(playerArray) {\n            this.showLeaderboardInternal(playerArray);\n        }.bind(this))\n        .catch(function(error) {\n        });\n    },\n\n    showLeaderboardInternal: function(playerArray) {\n        this.node.active = true;\n        this.updateLeaderboard(playerArray);\n        // this.show();\n    },\n\n    showLeaderboardDebug: function() {\n        let playerArray = new Array();\n        for (let i = 0; i < 15; i++) {\n            var playerInfo = {};\n            playerInfo.id = \"2127737910604444\";\n            playerInfo.playerName = \"player \" + i;\n            playerInfo.score = 10 + i * 2;\n            playerInfo.rank = i + 1;\n\n            if (i % 2 == 0) {\n                playerInfo.portraitUrl = \"https://platform-lookaside.fbsbx.com/platform/instantgames/profile_pic.jpg?igpid=2127737910604444&height=256&width=256&ext=1542184412&hash=AeRpQBaamgXpc3fM\";\n            } else {\n                playerInfo.portraitUrl = \"https://platform-lookaside.fbsbx.com/platform/instantgames/profile_pic.jpg?igpid=2445785048770311&height=256&width=256&ext=1542255362&hash=AeQ_-nxXrs2f6OE4\";\n            }\n\n            playerArray.push(playerInfo);\n        }\n\n        this.showLeaderboardInternal(playerArray);\n    },\n\n    show: function() {\n        var beginPos = cc.v2(0, -(this.canvasNode.height + this.node.height) / 2);\n        var endPos = cc.v2(0, 0);\n        var showAction = cc.moveTo(0.5, endPos).easing(cc.easeCubicActionOut());\n\n        this.node.position = beginPos;\n        this.node.runAction(showAction);\n    },\n\n    hide: function() {\n        var endPos = cc.v2(0, -(this.canvasNode.height + this.node.height) / 2); \n        var hideAction = cc.moveTo(0.5, endPos).easing(cc.easeCubicActionIn());\n        this.node.runAction(hideAction);\n    },\n\n    updateLeaderboard: function(playerArray) {\n        this.clearLeaderboard();\n        for (let i = 0; i < playerArray.length; i++) {\n            var playerItemNode = this.spawnPlayerItem();\n            playerItemNode.getComponent('PlayerItem').updatePlayerInfo(playerArray[i]);\n            playerItemNode.setParent(this.content);\n        }\n    },\n\n    clearLeaderboard: function() {\n        for (let i = this.content.childrenCount - 1; i >= 0; i--) {\n            this.despawnPlayerItem(this.content.children[i]);\n        }\n    },\n\n    spawnPlayerItem: function() {\n        if (this.playerItemPool.size() > 0) {\n            return this.playerItemPool.get(this);\n        } else {\n            return cc.instantiate(this.playerItemPrefab);\n        }\n    },\n\n    despawnPlayerItem: function(playerItemNode) {\n        this.playerItemPool.put(playerItemNode);\n    },\n});\n"]}